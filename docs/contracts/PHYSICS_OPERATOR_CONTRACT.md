# PHYSICS-OPERATOR contract (P0) — `H = L + V` и анти-иллюзия AUC

Назначение: зафиксировать минимальный (P0) “физический” оператор для спектральных фич и правила интерпретации AUC
в присутствии decoys разной сложности (hardness bins).

## 1) Fundamental operator (P0)

### 1.1 Топологический оператор (база)

Для молекулы строится граф `G=(V,E)` по heavy-атомам (нумерация соответствует матрице смежности).

Матрица смежности `A ∈ R^{n×n}` (пока бинарная):

```
A_ij = 1, если (i,j) ∈ E
A_ij = 0, иначе
```

Матрица степеней `D = diag(d_i)`, где `d_i = Σ_j A_ij`.

Лапласиан:

```
L = D - A
```

### 1.2 Физический оператор (P0)

Вводится диагональный потенциал `V = diag(V_i)`, зависящий от типа атома `t_i`:

```
H = L + V
```

P0-инвариант: `V` диагонален, `A` бинарная, `H` симметричен.

## 2) Topological blindness (официально)

Если две молекулы имеют одинаковую топологию (одинаковая `A`), то `L` одинаковый ⇒ `spec(L)` одинаковый.
Следовательно, `spec(L)` **не может** быть единственным валидатором “химичности” при изменении типов атомов.

Критерий успеха P0 (тестовый инвариант):

- `spec(L_A) ≈ spec(L_B)` для одинаковой топологии
- `spec(H_A) != spec(H_B)` если хотя бы один тип атома отличается и `V(t)` различается

## 3) Single Source of Truth (SoT) для потенциала `V(t)`

### 3.1 Единственный источник

Параметры потенциала берутся **только** из `data/atoms_db_v1.json`.
Хардкод словарей в `.py` запрещён.

### 3.2 Схема SoT (фиксируем как есть)

`data/atoms_db_v1.json` в проекте уже используется и имеет строки вида:

- `Z` (int) — atomic number
- `name` (str) — symbol
- `epsilon` (float) — используем как `potential_V` для P0

P0-соглашение: `potential_V(t) := epsilon(Z=t)`.

### 3.3 Политика отсутствующих параметров (жёстко)

Если в `atoms_db_v1.json` нет `epsilon` для атома, встреченного в молекуле:

- в коде бросается `MissingPhysicsParams`
- в batch-выводе строка помечается как `status=ERROR` с `reason=missing_physics_params`
- evidence pack **всё равно** собирается (audit-grade, без “тихих” провалов)

## 4) Hardness curve + запрет самообмана AUC

Декои могут быть “лёгкими” (слишком непохожими), и тогда высокая AUC может быть самообманом.

Пайплайн обязан выпускать артефакты:

- `hardness_curve.csv` (строка на пару original↔decoy)
- `hardness_curve.md` (правила биннинга + AUC по бинам + `auc_interpretation`)
- `summary_metadata.json` (агрегаты `n_*`, `auc_*`, `median_tanimoto`, `auc_interpretation`)

Политика `auc_interpretation` (P0):

- если данных в hard-бине недостаточно ⇒ `INCONCLUSIVE_DECOYS_TOO_EASY`
- если в hard-бине нет сигнала ⇒ `ILLUSION_CONFIRMED`
- если есть сигнал на hard ⇒ `SUCCESS_SIGNAL_ON_HARD`

## 5) Naming policy (обязательное)

В репозитории запрещены персоналии/фамилии: в текстах, названиях файлов, ключах JSON, названиях режимов.

