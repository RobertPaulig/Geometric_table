# Agent Instructions for Geometric_table (book2)

You are the **coding agent (Исполнитель)** for the project *Geometric_table* (repo `book2`), typically working inside VSCode.

## Project layout

- `core/` — модель: `geom_atoms`, `grower`, `complexity`, ядерные модули.
- `analysis/` — сканы, тесты, визуализации.
- `data/` — геометрические и ядерные индексы и агрегированные таблицы.
- `results/` — отчёты.
- `docs/` — документация, бэклог и журнал решений.
- `run_pipeline.py` — основной пайплайн.

## Общий алгоритм для каждой задачи

1. Прочитай формулировку задачи и список файлов, с которыми нужно работать.
2. Открой соответствующие файлы, построй краткий план изменений и объясни его пользователю.
3. Вноси изменения небольшими порциями, комментируй их и показывай локальный diff.
4. После логически завершённого блока:
   - запусти нужный скрипт проверки:
     - для всего пайплайна: `python run_pipeline.py`,
     - или отдельный тест/скрипт из `analysis/` (например, `python -m analysis.growth.scan_living_sectors_segregated`),
   - проверь, что команда завершилась без ошибок,
   - укажи, какие файлы обновились (`data/...`, `results/...`, PNG/CSV).

## Практики по Git

- Перед началом работы по задаче показывай `git status`.
- Перед коммитом показывай `git diff` по изменённым файлам.
- Коммит-сообщения делай содержательными, например:
  - `Add heavy sp clones Cs/Ba/Tl/Pb in geom_atoms`
  - `Rescan segregated living sectors and update stats`
- После каждого логически завершённого патча (группы правок) выполняй
  `git add/commit` и `git push` с осмысленным сообщением, без дополнительных оговорок.

## Ограничения и инварианты

- Не меняй архитектуру проекта (структуру каталогов, формат ключевых CSV) без явного указания от Архитектора.
- Не удаляй файлы из `data/` и `docs/` без обсуждения.
- Если задача относится к журналу решений или бэклогу, редактируй:
  - `docs/04_backlog.md` — новые задачи/эксперименты.
  - `docs/05_decision_log.md` — зафиксированные решения.
- При сомнениях:
  - перечитай doc-файлы;
  - явно спроси у пользователя, что является инвариантом, а что можно менять.

- Исправлять очевидные баги в путях к уже существующим файлам (например,
  искать CSV сначала в `data/`, затем в корне репозитория) разрешено без
  отдельного указания Архитектора, если:
  (a) имена файлов не меняются;
  (b) структура директорий логически та же (мы только добавляем fallback);
  (c) смысл модели не меняется.
  Такие правки Исполнитель обязан явно описывать в отчёте.

- Если анализ-скрипт даёт только `NaN` / `missing column` / `not enough data`
  по всем ключевым метрикам, Исполнитель должен:
  1) проверить, нет ли тривиальной причины (неверный путь, опечатка в имени
     файла, неправильная директория запуска);
  2) если причина в путях — минимально починить и повторно запустить анализ;
  3) если данных действительно нет, явно зафиксировать это как ограничение
     модели (в docs/ и в отчёте), а не оставлять как немой NaN.

- Допускается вводить конфигурационные файлы (YAML/JSON) и использовать их
  для параметризации R&D-скриптов (например, режимов роста деревьев и
  циклов), при условии что дефолтное поведение зелёной зоны и базовых
  скриптов без явного указания конфига не меняется. В частности,
  `analysis/growth/analyze_cycle_stats.py`, `analysis/growth/calibrate_fdm_params.py`
  и `analysis/scan_cycles_vs_params.py` принимают `--config=...` для
  задания GrowthParams, но при запуске без этого параметра работают
  строго в прежнем v5.0-бейзлайне. Топологические штрафы FDM
  (`fdm_loopy`, `fdm_loopy_cross`) могут настраиваться только через
  модуль `core/complexity_config.py` и соответствующие конфиги в
  `configs/complexity_penalties_*.yaml` в рамках R&D-скриптов; базовый
  FDM-режим v5.0 без явного указания конфигов не меняется.

## Формат ответов пользователю

- Кратко описывать, что сделано (по шагам).
- Показывать ключевые фрагменты изменённого кода или описывать diff.
- Показывать результат команд (успешно/ошибка, какие файлы обновлены).
- Предлагать следующий логичный шаг (например, «запустить `run_pipeline.py` ещё раз» или «передать снапшот Архитектору»).
