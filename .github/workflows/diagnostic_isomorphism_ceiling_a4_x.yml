name: diagnostic-isomorphism-ceiling-a4-x

permissions:
  contents: read

on:
  workflow_dispatch:

jobs:
  ceiling-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install (dev,chem)
        run: |
          python -m pip install --upgrade pip
          pip install -e ".[dev,chem]"

      - name: Run isomorphism ceiling test (A4.x)
        run: |
          python scripts/diagnostics/isomorphism_ceiling_a4_x.py \
            --input_csv data/accuracy/isomer_truth.v1.csv \
            --out_csv out_isomorphism_ceiling/isomorphism_ceiling.csv

      - name: Compute SHA256(csv)
        run: |
          SHA256=$(sha256sum out_isomorphism_ceiling/isomorphism_ceiling.csv | awk '{print toupper($1)}')
          echo "$SHA256  isomorphism_ceiling.csv" > out_isomorphism_ceiling/isomorphism_ceiling.csv.sha256
          echo "csv_sha256=$SHA256" >> $GITHUB_ENV
          echo "csv_sha256=$SHA256"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: isomorphism-ceiling-a4-x
          path: |
            out_isomorphism_ceiling/isomorphism_ceiling.csv
            out_isomorphism_ceiling/isomorphism_ceiling.csv.sha256

